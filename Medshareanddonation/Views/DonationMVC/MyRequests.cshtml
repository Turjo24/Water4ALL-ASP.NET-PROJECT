<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Donation Request</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                primary: '#3B82F6',
                secondary: '#10B981'
              }
            }
          }
        };
    </script>

    <style>
        html, body {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

            html::-webkit-scrollbar,
            body::-webkit-scrollbar {
                display: none;
            }
    </style>
</head>

<body class="bg-white text-gray-800 font-sans p-8">
    <h1 class="text-2xl font-bold mt-6 mb-10 text-center">My Donation Requests</h1>

    <!-- ✅ Header row -->
    <div class="grid grid-cols-12 gap-4 font-bold border-b pb-2 mb-2 px-10 bg-neutral-200/50 p-2">
        <div class="col-span-2 text-center">Name</div>
        <div class="col-span-2 text-center">Phone</div>
        <div class="col-span-2 text-center">Address</div>
        <div class="col-span-1 text-center">Liters</div>
        <div class="col-span-4 text-center">Reason</div>
        <div class="col-span-1 text-center">Status</div>
    </div>

    <!-- ✅ Container for data rows -->
    <div id="requestGrid" class="px-10 space-y-1"></div>

    <script>
        async function loadMyRequests() {
          try {
            const token = localStorage.getItem("token");
            if (!token) {
              alert("Please login to view your requests.");
              return;
            }

            const response = await fetch("https://localhost:7217/api/donation/MyRequests", {
              headers: {
                "Authorization": `Bearer ${token}`
              }
            });

            if (!response.ok) throw new Error("Failed to fetch your requests");

            const requests = await response.json();
            const grid = document.getElementById("requestGrid");
            grid.innerHTML = "";

            const statusMap = {
              Approved: {
                cls: "text-green-500 bg-green-200/50 border-green-500",
                color: "#22C55E"
              },
              Rejected: {
                cls: "text-red-500 bg-red-200/50 border-red-500",
                color: "#EF4444"
              },
              Pending: {
                cls: "text-yellow-500 bg-yellow-100 border-yellow-500",
                color: "#FE971E"
              }
            };

            requests.forEach(req => {
              const row = document.createElement('div');
              row.className = "grid grid-cols-12 gap-4 border-b h-[10vh] items-center";

              const status = statusMap[req.status] || statusMap.Pending; 

              row.innerHTML = `
                <div class="col-span-2 text-center">${req.name}</div>
                <div class="col-span-2 text-center">${req.phoneNumber}</div>
                <div class="col-span-2 text-center text-sm">${req.locationAddress}</div>
                <div class="col-span-1 text-center">${req.waterLiters} Liters</div>
                <div class="col-span-4 text-center text-xs">${req.reason}</div>
                <div class="col-span-1 flex items-center text-xs justify-center gap-2 border-2 p-1 rounded-lg ${status.cls}">
                  <svg fill="${status.color}" width="16" height="16" viewBox="0 0 20 20">
                    <path d="M7.8 10a2.2 2.2 0 0 0 4.4 0 2.2 2.2 0 0 0-4.4 0z"/>
                  </svg>
                  <span class="-translate-x-2">${req.status}</span>
                </div>
              `;

              grid.appendChild(row);
            });
          } catch (err) {
            console.error(err);
            alert("Error loading your donation requests");
          }
        }

        // ✅ CHANGED: Ensured the function is called after the DOM is ready
        document.addEventListener("DOMContentLoaded", loadMyRequests);
    </script>
</body>
</html>
