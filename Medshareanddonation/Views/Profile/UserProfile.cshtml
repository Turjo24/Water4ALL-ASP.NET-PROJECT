@{
    ViewData["Title"] = "User Profile";
}

<div class="flex justify-center items-center min-h-screen bg-gray-100">
    <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-md">

        <!-- Title -->
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
            User Profile
        </h2>

        <!-- Profile Info -->
        <div class="space-y-4 text-gray-700">
            <div class="flex justify-between border-b pb-2">
                <span class="font-semibold">👤 Name:</span>
                <span id="userName" class="text-gray-600">Loading...</span>
            </div>
            <div class="flex justify-between border-b pb-2">
                <span class="font-semibold">📧 Email:</span>
                <span id="email" class="text-gray-600">Loading...</span>
            </div>
            <div class="flex justify-between border-b pb-2">
                <span class="font-semibold">🎭 Role:</span>
                <span id="role" class="text-gray-600">Loading...</span>
            </div>
            <div class="flex justify-between">
                <span class="font-semibold">⏰ Login Time:</span>
                <span id="loginTime" class="text-gray-600">Loading...</span>
            </div>
        </div>

        
    </div>
</div>

<script>
    async function loadUserProfile() {
        const token = localStorage.getItem("token");
        if (!token) {
            alert("No token found! Please login.");
            return;
        }

        try {
            const response = await fetch('/Profile/GetData', {
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (!response.ok) {
                if (response.status === 401) {
                    alert("Unauthorized! Please login again.");
                    window.location.href = '/Login';
                } else {
                    const text = await response.text();
                    alert("Failed to load profile: " + text);
                }
                return;
            }

            const data = await response.json();

            
            const userNameEl = document.getElementById('userName');
            const emailEl = document.getElementById('email');
            const roleEl = document.getElementById('role');
            const loginTimeEl = document.getElementById('loginTime');

            if (userNameEl) userNameEl.innerText = localStorage.getItem("userName") || data.userName;
            if (emailEl) emailEl.innerText = localStorage.getItem("email") || data.email;
            if (roleEl) roleEl.innerText = localStorage.getItem("role") || data.role;
            if (loginTimeEl) loginTimeEl.innerText = localStorage.getItem("loginTime") || data.date;

        } catch (err) {
            console.error('Error loading profile:', err);
            alert('Error loading profile');
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        loadUserProfile();

        const updateBtn = document.getElementById("updateBtn");
        if (updateBtn) {
            updateBtn.addEventListener("click", () => {
                window.location.href = "/Profile/UpdateName";
            });
        }
    });
</script>
