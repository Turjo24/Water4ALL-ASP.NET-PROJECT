@{
    ViewData["Title"] = "Products";
}

<h2>Products</h2>

<div class="row" id="userProducts"></div>

@section Scripts {
    <script>
        const apiUrl = "https://localhost:7217/api/products";
        const token = localStorage.getItem("token"); // optional

        async function loadUserProducts() {
            try {
                const response = await fetch(apiUrl, {
                    headers: token ? { "Authorization": `Bearer ${token}` } : {}
                });
                const products = await response.json();
                const container = document.getElementById("userProducts");
                container.innerHTML = "";

                products.forEach(p => {
                    const card = document.createElement("div");
                    card.classList.add("col-md-3", "mb-3");
                    card.innerHTML = `
                        <div class="card">
                            <img src="${p.imageUrl || ''}" class="card-img-top" />
                            <div class="card-body">
                                <h5>${p.name}</h5>
                                <p>${p.description}</p>
                                <p><strong>$${p.price}</strong></p>
                                <p><em>${p.category}</em></p>
                                <button class="btn btn-primary btn-sm">Buy Now</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (err) {
                console.error(err);
                alert("Error loading products");
            }
        }

        document.addEventListener("DOMContentLoaded", loadUserProducts);
    </script>
}
